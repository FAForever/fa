name: Build

on: [pull_request]

jobs:
  syntax:
    name: Syntax
    runs-on: ubuntu-latest
    container: faforever/lua:v5.0-1
    steps:
      - name: Install utilities
        run: apk add bash git findutils
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          sparse-checkout: |
            *.sh
            *.lua
            *.bp
      - name: Check Lua syntax
        run: "bash ./run_lua_syntax_checker.sh"
  tests:
    name: Tests
    runs-on: ubuntu-latest
    container: faforever/lua:v5.0-1
    steps:
      - name: Install utilities
        run: apk add bash git findutils
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Run Lua tests
        run: "bash ./run_lua_tests.sh"
  testUnits:
    name: Sanity check on unit blueprints
    runs-on: ubuntu-latest
    container: faforever/lua:v5.0-1
    steps:
      - name: Install utilities
        run: apk add bash git findutils
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Run Lua tests
        run: "bash ./run_lua_blueprint_tests.sh"
